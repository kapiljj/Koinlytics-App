<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Koinlytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #F9FAFB; }
        .card { background-color: #1F2937; border: 1px solid #374151; border-radius: 0.75rem; }
        .btn { transition: all 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .input { background-color: #374151; border: 1px solid #4B5563; border-radius: 0.5rem; padding: 0.75rem 1rem; }
        .hidden { display: none; }
        .link { color: #60A5FA; cursor: pointer; text-decoration: underline; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="max-w-md w-full">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white">Koinlytics</h1>
            <p class="text-gray-400">Your All-in-One Crypto Dashboard</p>
        </header>
        <main>
            <div id="login-container" class="card p-8">
                <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
                <form id="login-form" class="space-y-4">
                    <input id="login-email" type="email" class="input w-full" placeholder="Email" required>
                    <input id="login-password" type="password" class="input w-full" placeholder="Password" required>
                    <button type="submit" class="btn w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg">Login</button>
                </form>
                <p class="text-center text-sm text-gray-400 mt-6">Don't have an account? <span id="show-signup" class="link">Sign up here</span></p>
                <div class="mt-4 pt-4 border-t border-gray-600">
                    <p class="text-center text-xs text-gray-500 mb-2">Admin Access</p>
                    <button id="admin-login-btn" class="btn w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 rounded-lg text-sm">Quick Admin Login</button>
                    <p class="text-center text-xs text-gray-400 mt-1">admin@bypass.com</p>
                </div>
            </div>
            <div id="signup-container" class="card p-8 hidden">
                <h2 class="text-2xl font-bold mb-6 text-center">Create Account</h2>
                <form id="signup-form" class="space-y-4">
                    <input id="signup-email" type="email" class="input w-full" placeholder="Email" required>
                    <input id="signup-password" type="password" class="input w-full" placeholder="Password (min. 6 chars)" required>
                    <button type="submit" class="btn w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg">Sign Up</button>
                </form>
                <p class="text-center text-sm text-gray-400 mt-6">Already have an account? <span id="show-login" class="link">Login here</span></p>
            </div>
        </main>
    </div>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const API_URL = 'https://koinlytics-app-production.up.railway.app/api';
    const existingSession = localStorage.getItem('koinlytics_session');
    if (existingSession) {
        try {
            const sessionData = JSON.parse(existingSession);
            if (sessionData.role === 'admin') {
                window.location.href = './admin.html';
            } else {
                window.location.href = './dashboard.html';
            }
        } catch (error) {
            localStorage.removeItem('koinlytics_session');
        }
    }
    const handleAuth = async (endpoint, email, password) => {
        const response = await fetch(`${API_URL}/auth/${endpoint}`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ email, password }) });
        const data = await response.json();
        if (!response.ok) throw new Error(data.error);
        return data;
    };
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            await handleAuth('signup', e.target.elements['signup-email'].value, e.target.elements['signup-password'].value);
            alert('Signup successful! Please log in.');
            toggleAuthForm('login');
        } catch (error) { alert(`Signup failed: ${error.message}`); }
    });
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
            const data = await handleAuth('login', e.target.elements['login-email'].value, e.target.elements['login-password'].value);
            localStorage.setItem('koinlytics_session', JSON.stringify(data));
            
            // Redirect based on user role
            if (data.role === 'admin') {
                window.location.href = './admin.html';
            } else {
                window.location.href = './dashboard.html';
            }
        } catch (error) { alert(`Login failed: ${error.message}`); }
    });
    const toggleAuthForm = (formToShow) => {
        document.getElementById('login-container').classList.toggle('hidden', formToShow === 'signup');
        document.getElementById('signup-container').classList.toggle('hidden', formToShow !== 'signup');
    };
    document.getElementById('show-signup').addEventListener('click', () => toggleAuthForm('signup'));
    document.getElementById('show-login').addEventListener('click', () => toggleAuthForm('login'));
    
    // Admin quick login button
    document.getElementById('admin-login-btn').addEventListener('click', async () => {
        try {
            const data = await handleAuth('login', 'admin@bypass.com', 'admin123');
            localStorage.setItem('koinlytics_session', JSON.stringify(data));
            window.location.href = './admin.html';
        } catch (error) {
            alert(`Admin login failed: ${error.message}`);
        }
    });
});
</script>
</body>
</html>
